<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcana Studio Labs | The Codex of the Witch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Outfit:wght@200;400;600;800&display=swap');
        
        :root { 
            --gold: #f59e0b; 
            --mystic: #8b5cf6; 
            --wood: #10b981;
            --fire: #ef4444;
            --earth: #b45309;
            --metal: #e5e7eb;
            --water: #3b82f6;
        }
        
        body { 
            font-family: 'Outfit', sans-serif; 
            background: #020617; 
            color: #e2e8f0; 
            overflow-x: hidden; 
            position: relative;
        }
        
        h1, h2, .font-serif, .codex-title { 
            font-family: 'Cinzel', serif; 
        }

        .stars { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -2; 
            background: radial-gradient(ellipse at bottom, #1e1b4b 0%, #020617 100%);
        }
        
        .twinkling {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.5;
            background: transparent;
            animation: twinkle 4s infinite;
            background-image: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 3px 3px;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; }
            50% { opacity: 0.6; }
            100% { opacity: 0.3; }
        }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 35px -10px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .glass-panel:hover {
            border-color: rgba(245, 158, 11, 0.3);
            box-shadow: 0 25px 40px -12px rgba(245, 158, 11, 0.15);
        }

        .element-bar { 
            transition: width 1.2s cubic-bezier(0.23, 1, 0.32, 1); 
        }
        
        .moon-ring { 
            animation: rotate 30s linear infinite; 
        }
        
        @keyframes rotate { 
            from { transform: rotate(0deg); } 
            to { transform: rotate(360deg); } 
        }
        
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top: 3px solid #f59e0b;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .lucky-hour-badge {
            animation: pulse 2s infinite;
            transition: all 0.3s ease;
        }
        
        .lucky-hour-badge:hover {
            transform: scale(1.02);
            border-color: #f59e0b !important;
        }
        
        @keyframes pulse {
            0% { opacity: 0.9; box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.2); }
            50% { opacity: 1; box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1); }
            100% { opacity: 0.9; box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.2); }
        }
        
        input:focus, select:focus {
            border-color: #f59e0b !important;
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.1);
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip:hover:after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: #e2e8f0;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
            border: 1px solid rgba(245, 158, 11, 0.3);
            margin-bottom: 8px;
            pointer-events: none;
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .prophecy-tab {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .prophecy-tab:hover {
            background: rgba(245, 158, 11, 0.1);
        }

        .prophecy-tab.active {
            background: rgba(245, 158, 11, 0.2);
            border-color: #f59e0b !important;
            color: #f59e0b !important;
        }

        .star-rating {
            display: flex;
            gap: 4px;
            justify-content: center;
        }
        
        .star {
            font-size: 24px;
            color: #334155;
            transition: all 0.3s ease;
        }
        
        .star.filled {
            color: #f59e0b;
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #f59e0b;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #d97706;
        }

        /* CODEX QUOTE BOX - SMALLER FONT */
        .codex-quote-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);
            border-left: 4px solid #f59e0b;
            border-right: 4px solid #8b5cf6;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            position: relative;
            backdrop-filter: blur(8px);
            max-width: 700px;
            margin: 1rem auto 0.5rem auto;
        }

        .codex-quote-text {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            color: #fcd34d;
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.2);
            line-height: 1.5;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        .codex-attribution {
            font-size: 0.6rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: #a78bfa;
            margin-top: 0.5rem;
        }

        /* LOGO - ENLARGED TO 200px */
        .logo-image {
            width: 200px;
            height: 200px;
            margin: 1.5rem auto;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(245,158,11,0.2) 0%, rgba(139,92,246,0.2) 100%);
            border: 3px solid rgba(245,158,11,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(245,158,11,0.3);
        }

        .logo-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-placeholder {
            color: #f59e0b;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            text-align: center;
        }

        .logo-placeholder i {
            font-size: 5rem !important;
            margin-bottom: 0.75rem;
            color: #f59e0b;
            text-shadow: 0 0 30px rgba(245,158,11,0.6);
        }

        .logo-placeholder div {
            font-size: 0.75rem;
            letter-spacing: 0.3em;
        }

        .comfort-quote-box {
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.08) 0%, rgba(139, 92, 246, 0.08) 100%);
            border-radius: 8px;
            padding: 1.25rem;
            border-bottom: 2px solid #f59e0b;
            border-top: 2px solid #8b5cf6;
        }

        .comfort-quote-text {
            font-size: 1rem;
            line-height: 1.6;
            color: #e2e8f0;
            font-style: italic;
        }

        .oracle-counsel-box {
            min-height: 200px;
            padding: 2rem !important;
        }

        .oracle-counsel-text {
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .celestial-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: #8b5cf6;
            font-size: 0.75rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin: 0.5rem 0;
        }

        .celestial-divider i {
            color: #f59e0b;
            font-size: 0.6rem;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f59e0b'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5rem;
            padding-right: 2.5rem;
        }

        select option {
            background-color: #0f172a;
            color: #e2e8f0;
            padding: 0.5rem;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="stars"></div>
    <div class="twinkling"></div>

    <header class="max-w-6xl mx-auto text-center mb-8 fade-in">
        <!-- 1. ARCANA STUDIO LABS -->
        <h1 class="text-4xl md:text-6xl font-bold tracking-tighter text-white mb-3 drop-shadow-lg codex-title" style="text-shadow: 0 0 20px rgba(245,158,11,0.3);">
            ARCANA STUDIO LABS
        </h1>
        
        <!-- 2. The Codex of the Witch -->
        <div class="text-amber-400 text-sm md:text-base font-serif italic mb-3 tracking-wide">The Codex of the Witch</div>
        
        <!-- 3. The Celestial Alchemy ‚Äî Cartography of the Soul -->
        <div class="celestial-divider">
            <i class="fas fa-star"></i>
            <span class="text-purple-400 text-xs">THE CELESTIAL ALCHEMY ‚Äî CARTOGRAPHY OF THE SOUL</span>
            <i class="fas fa-star"></i>
        </div>
        
        <!-- 4. Logo - ENLARGED to 200px -->
        <div class="logo-image">
            <!-- YOUR LOGO HERE - REPLACE THIS DIV WITH IMG TAG -->
            <img src="logo.jpg" alt="Arcana Studio Labs Logo">
            <!-- REPLACE THE ABOVE WITH: <img src="your-logo.jpg" alt="Arcana Studio Labs Logo"> -->
        </div>
        
        <!-- 5. Codex Quote - FONT REDUCED to 0.9rem -->
        <div class="codex-quote-box">
            <div class="codex-quote-text">
                "Less than half of you is given at birth. The greater half is forged."
            </div>
            <div class="codex-attribution">
                ‚Äî THE CODEX OF THE WITCH
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- LEFT PANEL - INPUT SECTION -->
        <section class="lg:col-span-4 space-y-6">
            <div class="glass-panel p-8 rounded-3xl border-l-4 border-amber-500 fade-in">
                <h2 class="text-xl text-white mb-6 font-serif tracking-wide">Celestial Identity</h2>
                <div class="space-y-5">
                    <!-- Full Name -->
                    <div>
                        <label class="text-[10px] uppercase tracking-widest text-slate-400">Full Name</label>
                        <input type="text" id="name" placeholder="Enter your complete name" value="" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 outline-none focus:border-amber-500 transition text-white placeholder-slate-600">
                    </div>
                    
                    <!-- Birth Date & Time -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] uppercase tracking-widest text-slate-400">Birth Date</label>
                            <input type="date" id="dob" value="" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 text-sm outline-none focus:border-amber-500 text-white [color-scheme:dark]">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase tracking-widest text-slate-400">Birth Time</label>
                            <input type="time" id="tob" value="" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 text-sm outline-none focus:border-amber-500 text-white [color-scheme:dark]">
                        </div>
                    </div>
                    
                    <!-- Gender & Relationship -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] uppercase tracking-widest text-slate-400">Gender</label>
                            <select id="gender" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 outline-none focus:border-amber-500 text-white">
                                <option value="" disabled selected>Select gender</option>
                                <option value="male">Male (Yang)</option>
                                <option value="female">Female (Yin)</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[10px] uppercase tracking-widest text-slate-400">Relationship</label>
                            <select id="relationship" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 outline-none focus:border-amber-500 text-white">
                                <option value="" disabled selected>Select status</option>
                                <option value="single">Single</option>
                                <option value="dating">Dating</option>
                                <option value="engaged">Engaged</option>
                                <option value="married">Married</option>
                                <option value="divorced">Divorced</option>
                                <option value="widowed">Widowed</option>
                                <option value="complicated">It's Complicated</option>
                            </select>
                        </div>
                    </div>

                    <!-- COMPLETE COUNTRY LIST -->
                    <div>
                        <label class="text-[10px] uppercase tracking-widest text-slate-400">Birth Country</label>
                        <select id="country" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 outline-none focus:border-amber-500 text-white text-sm">
                            <option value="" disabled selected>Select your birth country</option>
                            <option value="AF">Afghanistan</option>
                            <option value="AL">Albania</option>
                            <option value="DZ">Algeria</option>
                            <option value="AD">Andorra</option>
                            <option value="AO">Angola</option>
                            <option value="AG">Antigua and Barbuda</option>
                            <option value="AR">Argentina</option>
                            <option value="AM">Armenia</option>
                            <option value="AU">Australia</option>
                            <option value="AT">Austria</option>
                            <option value="AZ">Azerbaijan</option>
                            <option value="BS">Bahamas</option>
                            <option value="BH">Bahrain</option>
                            <option value="BD">Bangladesh</option>
                            <option value="BB">Barbados</option>
                            <option value="BY">Belarus</option>
                            <option value="BE">Belgium</option>
                            <option value="BZ">Belize</option>
                            <option value="BJ">Benin</option>
                            <option value="BT">Bhutan</option>
                            <option value="BO">Bolivia</option>
                            <option value="BA">Bosnia and Herzegovina</option>
                            <option value="BW">Botswana</option>
                            <option value="BR">Brazil</option>
                            <option value="BN">Brunei</option>
                            <option value="BG">Bulgaria</option>
                            <option value="BF">Burkina Faso</option>
                            <option value="BI">Burundi</option>
                            <option value="CV">Cabo Verde</option>
                            <option value="KH">Cambodia</option>
                            <option value="CM">Cameroon</option>
                            <option value="CA">Canada</option>
                            <option value="CF">Central African Republic</option>
                            <option value="TD">Chad</option>
                            <option value="CL">Chile</option>
                            <option value="CN">China</option>
                            <option value="CO">Colombia</option>
                            <option value="KM">Comoros</option>
                            <option value="CG">Congo</option>
                            <option value="CR">Costa Rica</option>
                            <option value="HR">Croatia</option>
                            <option value="CU">Cuba</option>
                            <option value="CY">Cyprus</option>
                            <option value="CZ">Czech Republic</option>
                            <option value="DK">Denmark</option>
                            <option value="DJ">Djibouti</option>
                            <option value="DM">Dominica</option>
                            <option value="DO">Dominican Republic</option>
                            <option value="EC">Ecuador</option>
                            <option value="EG">Egypt</option>
                            <option value="SV">El Salvador</option>
                            <option value="GQ">Equatorial Guinea</option>
                            <option value="ER">Eritrea</option>
                            <option value="EE">Estonia</option>
                            <option value="SZ">Eswatini</option>
                            <option value="ET">Ethiopia</option>
                            <option value="FJ">Fiji</option>
                            <option value="FI">Finland</option>
                            <option value="FR">France</option>
                            <option value="GA">Gabon</option>
                            <option value="GM">Gambia</option>
                            <option value="GE">Georgia</option>
                            <option value="DE">Germany</option>
                            <option value="GH">Ghana</option>
                            <option value="GR">Greece</option>
                            <option value="GD">Grenada</option>
                            <option value="GT">Guatemala</option>
                            <option value="GN">Guinea</option>
                            <option value="GW">Guinea-Bissau</option>
                            <option value="GY">Guyana</option>
                            <option value="HT">Haiti</option>
                            <option value="HN">Honduras</option>
                            <option value="HU">Hungary</option>
                            <option value="IS">Iceland</option>
                            <option value="IN">India</option>
                            <option value="ID">Indonesia</option>
                            <option value="IR">Iran</option>
                            <option value="IQ">Iraq</option>
                            <option value="IE">Ireland</option>
                            <option value="IL">Israel</option>
                            <option value="IT">Italy</option>
                            <option value="JM">Jamaica</option>
                            <option value="JP">Japan</option>
                            <option value="JO">Jordan</option>
                            <option value="KZ">Kazakhstan</option>
                            <option value="KE">Kenya</option>
                            <option value="KI">Kiribati</option>
                            <option value="KP">North Korea</option>
                            <option value="KR">South Korea</option>
                            <option value="XK">Kosovo</option>
                            <option value="KW">Kuwait</option>
                            <option value="KG">Kyrgyzstan</option>
                            <option value="LA">Laos</option>
                            <option value="LV">Latvia</option>
                            <option value="LB">Lebanon</option>
                            <option value="LS">Lesotho</option>
                            <option value="LR">Liberia</option>
                            <option value="LY">Libya</option>
                            <option value="LI">Liechtenstein</option>
                            <option value="LT">Lithuania</option>
                            <option value="LU">Luxembourg</option>
                            <option value="MG">Madagascar</option>
                            <option value="MW">Malawi</option>
                            <option value="MY">Malaysia</option>
                            <option value="MV">Maldives</option>
                            <option value="ML">Mali</option>
                            <option value="MT">Malta</option>
                            <option value="MH">Marshall Islands</option>
                            <option value="MR">Mauritania</option>
                            <option value="MU">Mauritius</option>
                            <option value="MX">Mexico</option>
                            <option value="FM">Micronesia</option>
                            <option value="MD">Moldova</option>
                            <option value="MC">Monaco</option>
                            <option value="MN">Mongolia</option>
                            <option value="ME">Montenegro</option>
                            <option value="MA">Morocco</option>
                            <option value="MZ">Mozambique</option>
                            <option value="MM">Myanmar</option>
                            <option value="NA">Namibia</option>
                            <option value="NR">Nauru</option>
                            <option value="NP">Nepal</option>
                            <option value="NL">Netherlands</option>
                            <option value="NZ">New Zealand</option>
                            <option value="NI">Nicaragua</option>
                            <option value="NE">Niger</option>
                            <option value="NG">Nigeria</option>
                            <option value="MK">North Macedonia</option>
                            <option value="NO">Norway</option>
                            <option value="OM">Oman</option>
                            <option value="PK">Pakistan</option>
                            <option value="PW">Palau</option>
                            <option value="PS">Palestine</option>
                            <option value="PA">Panama</option>
                            <option value="PG">Papua New Guinea</option>
                            <option value="PY">Paraguay</option>
                            <option value="PE">Peru</option>
                            <option value="PH">Philippines</option>
                            <option value="PL">Poland</option>
                            <option value="PT">Portugal</option>
                            <option value="QA">Qatar</option>
                            <option value="RO">Romania</option>
                            <option value="RU">Russia</option>
                            <option value="RW">Rwanda</option>
                            <option value="KN">Saint Kitts and Nevis</option>
                            <option value="LC">Saint Lucia</option>
                            <option value="VC">Saint Vincent and the Grenadines</option>
                            <option value="WS">Samoa</option>
                            <option value="SM">San Marino</option>
                            <option value="ST">Sao Tome and Principe</option>
                            <option value="SA">Saudi Arabia</option>
                            <option value="SN">Senegal</option>
                            <option value="RS">Serbia</option>
                            <option value="SC">Seychelles</option>
                            <option value="SL">Sierra Leone</option>
                            <option value="SG">Singapore</option>
                            <option value="SK">Slovakia</option>
                            <option value="SI">Slovenia</option>
                            <option value="SB">Solomon Islands</option>
                            <option value="SO">Somalia</option>
                            <option value="ZA">South Africa</option>
                            <option value="SS">South Sudan</option>
                            <option value="ES">Spain</option>
                            <option value="LK">Sri Lanka</option>
                            <option value="SD">Sudan</option>
                            <option value="SR">Suriname</option>
                            <option value="SE">Sweden</option>
                            <option value="CH">Switzerland</option>
                            <option value="SY">Syria</option>
                            <option value="TW">Taiwan</option>
                            <option value="TJ">Tajikistan</option>
                            <option value="TZ">Tanzania</option>
                            <option value="TH">Thailand</option>
                            <option value="TL">Timor-Leste</option>
                            <option value="TG">Togo</option>
                            <option value="TO">Tonga</option>
                            <option value="TT">Trinidad and Tobago</option>
                            <option value="TN">Tunisia</option>
                            <option value="TR">Turkey</option>
                            <option value="TM">Turkmenistan</option>
                            <option value="TV">Tuvalu</option>
                            <option value="UG">Uganda</option>
                            <option value="UA">Ukraine</option>
                            <option value="AE">United Arab Emirates</option>
                            <option value="GB">United Kingdom</option>
                            <option value="US">United States</option>
                            <option value="UY">Uruguay</option>
                            <option value="UZ">Uzbekistan</option>
                            <option value="VU">Vanuatu</option>
                            <option value="VA">Vatican City</option>
                            <option value="VE">Venezuela</option>
                            <option value="VN">Vietnam</option>
                            <option value="YE">Yemen</option>
                            <option value="ZM">Zambia</option>
                            <option value="ZW">Zimbabwe</option>
                        </select>
                    </div>

                    <!-- COMPLETE TIMEZONE LIST -->
                    <div>
                        <label class="text-[10px] uppercase tracking-widest text-slate-400">Timezone</label>
                        <select id="timezone" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 outline-none focus:border-amber-500 text-white text-sm">
                            <option value="" disabled selected>Select your timezone</option>
                            <optgroup label="UTC -12:00 to -09:00">
                                <option value="-12">(UTC-12:00) Baker Island, Howland Island</option>
                                <option value="-11">(UTC-11:00) American Samoa, Niue</option>
                                <option value="-10">(UTC-10:00) Hawaii, Papeete</option>
                                <option value="-9.5">(UTC-09:30) Marquesas Islands</option>
                                <option value="-9">(UTC-09:00) Anchorage, Juneau</option>
                            </optgroup>
                            <optgroup label="UTC -08:00 to -06:00">
                                <option value="-8">(UTC-08:00) Los Angeles, Vancouver, Tijuana</option>
                                <option value="-7">(UTC-07:00) Denver, Phoenix, Calgary</option>
                                <option value="-6">(UTC-06:00) Chicago, Mexico City, Guatemala City</option>
                            </optgroup>
                            <optgroup label="UTC -05:00 to -03:00">
                                <option value="-5">(UTC-05:00) New York, Toronto, Havana</option>
                                <option value="-4">(UTC-04:00) Santiago, La Paz, Santo Domingo</option>
                                <option value="-3.5">(UTC-03:30) St. John's, Newfoundland</option>
                                <option value="-3">(UTC-03:00) Buenos Aires, S√£o Paulo, Montevideo</option>
                                <option value="-2">(UTC-02:00) South Georgia, Fernando de Noronha</option>
                                <option value="-1">(UTC-01:00) Azores, Cape Verde</option>
                            </optgroup>
                            <optgroup label="UTC ¬±00:00">
                                <option value="0">(UTC¬±00:00) London, Dublin, Lisbon, Accra</option>
                            </optgroup>
                            <optgroup label="UTC +01:00 to +03:00">
                                <option value="1">(UTC+01:00) Paris, Berlin, Rome, Madrid</option>
                                <option value="2">(UTC+02:00) Cairo, Jerusalem, Athens, Helsinki</option>
                                <option value="3">(UTC+03:00) Moscow, Istanbul, Nairobi, Baghdad</option>
                                <option value="3.5">(UTC+03:30) Tehran</option>
                            </optgroup>
                            <optgroup label="UTC +04:00 to +06:00">
                                <option value="4">(UTC+04:00) Dubai, Baku, Tbilisi</option>
                                <option value="4.5">(UTC+04:30) Kabul</option>
                                <option value="5">(UTC+05:00) Karachi, Tashkent, Yekaterinburg</option>
                                <option value="5.5">(UTC+05:30) Mumbai, New Delhi, Colombo</option>
                                <option value="5.75">(UTC+05:45) Kathmandu</option>
                                <option value="6">(UTC+06:00) Dhaka, Almaty, Omsk</option>
                                <option value="6.5">(UTC+06:30) Yangon</option>
                            </optgroup>
                            <optgroup label="UTC +07:00 to +09:00">
                                <option value="7">(UTC+07:00) Bangkok, Jakarta, Ho Chi Minh City</option>
                                <option value="8">(UTC+08:00) Beijing, Singapore, Perth, Taipei</option>
                                <option value="8.75">(UTC+08:45) Eucla</option>
                                <option value="9">(UTC+09:00) Tokyo, Seoul, Osaka, Yakutsk</option>
                                <option value="9.5">(UTC+09:30) Adelaide, Darwin</option>
                            </optgroup>
                            <optgroup label="UTC +10:00 to +14:00">
                                <option value="10">(UTC+10:00) Sydney, Melbourne, Guam, Vladivostok</option>
                                <option value="10.5">(UTC+10:30) Lord Howe Island</option>
                                <option value="11">(UTC+11:00) Solomon Islands, Noum√©a</option>
                                <option value="12">(UTC+12:00) Auckland, Fiji, Kamchatka</option>
                                <option value="12.75">(UTC+12:45) Chatham Islands</option>
                                <option value="13">(UTC+13:00) Tonga, Samoa, Phoenix Islands</option>
                                <option value="14">(UTC+14:00) Kiribati (Line Islands)</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- Career Field -->
                    <div>
                        <label class="text-[10px] uppercase tracking-widest text-slate-400">Career Field</label>
                        <select id="career" class="w-full bg-slate-900/50 border-b-2 border-slate-700 p-3 outline-none focus:border-amber-500 text-white">
                            <option value="" disabled selected>Select your career field</option>
                            <option value="Technology">Technology / IT</option>
                            <option value="Finance">Finance / Banking</option>
                            <option value="Healthcare">Healthcare / Medicine</option>
                            <option value="Education">Education / Academia</option>
                            <option value="Creative">Creative / Arts</option>
                            <option value="Business">Business / Entrepreneurship</option>
                            <option value="Legal">Legal / Law</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Sales">Sales / Marketing</option>
                            <option value="Government">Government / Public Service</option>
                            <option value="Hospitality">Hospitality / Tourism</option>
                            <option value="Construction">Construction / Trades</option>
                            <option value="Science">Science / Research</option>
                            <option value="Agriculture">Agriculture / Farming</option>
                            <option value="Military">Military / Defense</option>
                            <option value="Nonprofit">Nonprofit / Charity</option>
                            <option value="Retail">Retail / E-commerce</option>
                            <option value="Transportation">Transportation / Logistics</option>
                            <option value="Energy">Energy / Utilities</option>
                            <option value="Telecommunications">Telecommunications</option>
                            <option value="Media">Media / Entertainment</option>
                            <option value="Sports">Sports / Recreation</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <button onclick="calculateOracle()" id="invokeBtn" class="w-full py-4 mt-4 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white font-bold rounded-xl transition-all shadow-lg shadow-amber-900/30 hover:shadow-amber-600/40 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 opacity-50 cursor-not-allowed" disabled>
                        <i class="fas fa-crystal-ball"></i>
                        <span>COMPLETE YOUR CELESTIAL IDENTITY</span>
                    </button>
                    <p id="form-warning" class="text-[10px] text-amber-400/70 text-center mt-2">‚ö†Ô∏è All fields required to forge your reading</p>
                </div>
            </div>

            <!-- MOON PHASE WIDGET -->
            <div id="moon-widget" class="glass-panel p-6 rounded-3xl text-center overflow-hidden relative fade-in opacity-50">
                <div class="absolute -right-4 -top-4 opacity-10">
                    <i class="fas fa-moon text-8xl moon-ring text-amber-300"></i>
                </div>
                <h3 class="text-slate-400 text-xs uppercase tracking-widest mb-2">üåô Current Lunar Phase</h3>
                <div id="moon-display" class="text-2xl text-white font-serif italic">--</div>
                <div id="moon-illumination" class="text-xs text-amber-400/80 mt-1"></div>
                <p id="moon-desc" class="text-xs text-slate-500 mt-2">Awaiting your cosmic identity...</p>
            </div>
        </section>

        <!-- RIGHT PANEL - RESULTS SECTION -->
        <section id="results" class="lg:col-span-8 hidden space-y-8 fade-in">
            
            <!-- TOP GRID - ELEMENTS & QUICK STATS -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Wu Xing Elements -->
                <div class="glass-panel p-6 rounded-3xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white text-sm uppercase tracking-widest border-b border-slate-800 pb-2 flex items-center gap-2">
                            <i class="fas fa-circle text-[#10b981] text-xs"></i> Wu Xing (5 Elements)
                        </h3>
                        <span id="dominant-element" class="text-[10px] px-2 py-1 bg-amber-500/20 rounded-full text-amber-400"></span>
                    </div>
                    <div class="space-y-4" id="element-bars"></div>
                </div>
                
                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="glass-panel p-4 rounded-2xl flex flex-col items-center justify-center border-t-2 border-cyan-500 tooltip transition-all" data-tooltip="Your auspicious direction for 2026">
                        <span class="text-[10px] text-slate-500 uppercase flex items-center gap-1"><i class="fas fa-compass text-cyan-400"></i> Lucky Direction</span>
                        <span id="res-dir" class="text-xl text-cyan-400 font-bold">--</span>
                    </div>
                    <div class="glass-panel p-4 rounded-2xl flex flex-col items-center justify-center border-t-2 border-rose-500 tooltip" data-tooltip="Stone that enhances your energy">
                        <span class="text-[10px] text-slate-500 uppercase flex items-center gap-1"><i class="fas fa-gem text-rose-400"></i> Personal Gem</span>
                        <span id="res-gem" class="text-sm text-rose-400 font-bold text-center">--</span>
                    </div>
                    <div class="glass-panel p-4 rounded-2xl flex flex-col items-center justify-center border-t-2 border-emerald-500 tooltip" data-tooltip="Your celestial number">
                        <span class="text-[10px] text-slate-500 uppercase flex items-center gap-1"><i class="fas fa-hashtag text-emerald-400"></i> Lucky Number</span>
                        <span id="res-num" class="text-2xl text-emerald-400 font-bold">--</span>
                    </div>
                    <div class="glass-panel p-4 rounded-2xl flex flex-col items-center justify-center border-t-2 border-purple-500 tooltip" data-tooltip="Colors that attract positive energy">
                        <span class="text-[10px] text-slate-500 uppercase flex items-center gap-1"><i class="fas fa-palette text-purple-400"></i> Lucky Color</span>
                        <span id="res-color" class="text-sm text-purple-400 font-bold text-center">--</span>
                    </div>
                    <!-- LUCKY ANIMAL ORNAMENT -->
                    <div class="glass-panel p-4 rounded-2xl flex flex-col items-center justify-center border-t-2 border-amber-500 tooltip col-span-2" data-tooltip="Protective charm for your animal sign">
                        <span class="text-[10px] text-slate-500 uppercase flex items-center gap-1"><i class="fas fa-paw text-amber-400"></i> Lucky Animal Ornament</span>
                        <span id="res-animal" class="text-sm text-amber-400 font-bold text-center">--</span>
                    </div>
                </div>
            </div>

            <!-- TODAY'S FORTUNE METER -->
            <div class="glass-panel p-6 rounded-3xl bg-gradient-to-r from-indigo-900/30 to-purple-900/30 border border-amber-500/20">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-white text-sm uppercase tracking-widest flex items-center gap-2">
                        <i class="fas fa-star text-amber-400"></i> Today's Fortune Meter
                    </h3>
                    <span id="fortune-label" class="text-xs px-3 py-1 rounded-full bg-amber-500/20 text-amber-400">--</span>
                </div>
                
                <div id="star-rating" class="star-rating mb-4">
                    <span id="star-1" class="star"><i class="far fa-star"></i></span>
                    <span id="star-2" class="star"><i class="far fa-star"></i></span>
                    <span id="star-3" class="star"><i class="far fa-star"></i></span>
                    <span id="star-4" class="star"><i class="far fa-star"></i></span>
                    <span id="star-5" class="star"><i class="far fa-star"></i></span>
                </div>
                
                <div id="comfort-quote" class="comfort-quote-box mt-3">
                    <div class="comfort-quote-text"></div>
                    <div class="text-[10px] text-purple-400 mt-2 text-right uppercase tracking-wider">
                        ‚Äî THE CODEX OF THE WITCH
                    </div>
                </div>
            </div>

            <!-- PROPHECY TABS & PERSONAL YEAR - LOVE TAB 100% FIXED -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-panel p-6 rounded-3xl md:col-span-2 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-amber-500/5 rounded-full blur-3xl"></div>
                    
                    <!-- PROPHECY TABS - LOVE TAB NOW 100% WORKING -->
                    <div class="flex flex-wrap gap-2 mb-6 border-b border-slate-800 pb-4">
                        <button type="button" onclick="switchProphecyTab('wealth')" id="tab-wealth" class="prophecy-tab active px-4 py-2 rounded-lg text-sm flex items-center gap-2 text-amber-400 border border-amber-500/30">
                            <i class="fas fa-coins"></i> Wealth
                        </button>
                        <button type="button" onclick="switchProphecyTab('career')" id="tab-career" class="prophecy-tab px-4 py-2 rounded-lg text-sm flex items-center gap-2 text-slate-400 border border-transparent">
                            <i class="fas fa-briefcase"></i> Career
                        </button>
                        <button type="button" onclick="switchProphecyTab('health')" id="tab-health" class="prophecy-tab px-4 py-2 rounded-lg text-sm flex items-center gap-2 text-slate-400 border border-transparent">
                            <i class="fas fa-heartbeat"></i> Health
                        </button>
                        <button type="button" onclick="switchProphecyTab('love')" id="tab-love" class="prophecy-tab px-4 py-2 rounded-lg text-sm flex items-center gap-2 text-slate-400 border border-transparent">
                            <i class="fas fa-heart"></i> Love
                        </button>
                    </div>
                    
                    <div id="prophecy-content">
                        <h3 class="text-amber-400 font-serif text-2xl mb-2 italic flex items-center gap-2">
                            <i id="prophecy-icon" class="fas fa-coins"></i>
                            <span id="prophecy-title">Wealth Prophecy</span>
                        </h3>
                        <p id="main-prophecy" class="text-slate-300 leading-relaxed text-lg">Your cosmic alignment is being forged...</p>
                    </div>
                    
                    <hr class="my-6 border-slate-800">
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-slate-500 block text-[10px] uppercase tracking-wider">üåû Western Zodiac</span>
                            <span id="res-western" class="text-white font-bold text-lg">--</span>
                        </div>
                        <div>
                            <span class="text-slate-500 block text-[10px] uppercase tracking-wider">üêâ Eastern Pillar</span>
                            <span id="res-eastern" class="text-white font-bold text-lg">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="glass-panel p-6 rounded-3xl bg-gradient-to-br from-indigo-900/40 to-purple-900/40 border-t-2 border-indigo-500 flex flex-col justify-center">
                    <h3 class="text-indigo-400 text-xs uppercase tracking-widest mb-2 flex items-center gap-1">
                        <i class="fas fa-star"></i> Personal Year 2026
                    </h3>
                    <div id="res-py" class="text-7xl font-bold text-white mb-1">--</div>
                    <div class="w-full bg-slate-800 h-1.5 rounded-full mt-2 mb-3">
                        <div id="py-progress" class="bg-indigo-500 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="res-py-desc" class="text-xs text-slate-300">Your vibration for the 2026 cycle.</p>
                    <div id="res-py-element" class="text-[10px] mt-2 text-indigo-300"></div>
                    <div id="relationship-display" class="text-[10px] mt-3 pt-2 border-t border-indigo-800/50 text-indigo-300"></div>
                </div>
            </div>

            <!-- ORACLE'S COUNSEL -->
            <div class="glass-panel oracle-counsel-box rounded-3xl border border-amber-500/20">
                <div class="flex items-start gap-4 mb-4">
                    <div class="h-14 w-14 rounded-full bg-amber-500/20 flex items-center justify-center text-amber-500 flex-shrink-0">
                        <i class="fas fa-crown text-2xl"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-2xl font-serif text-white mb-2">Oracle's Counsel</h3>
                        <div id="res-advice" class="text-slate-300 oracle-counsel-text leading-relaxed">
                            The Codex awaits your identity...
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-6">
                    <div class="bg-slate-800/50 p-4 rounded-xl text-center">
                        <span class="text-[9px] uppercase text-slate-500 tracking-wider">Year Pillar</span>
                        <span id="pillar-year" class="block text-amber-400 font-bold text-base mt-1">--</span>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-xl text-center">
                        <span class="text-[9px] uppercase text-slate-500 tracking-wider">Month Pillar</span>
                        <span id="pillar-month" class="block text-amber-400 font-bold text-base mt-1">--</span>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-xl text-center">
                        <span class="text-[9px] uppercase text-slate-500 tracking-wider">Day Pillar</span>
                        <span id="pillar-day" class="block text-amber-400 font-bold text-base mt-1">--</span>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-xl text-center">
                        <span class="text-[9px] uppercase text-slate-500 tracking-wider">Hour Pillar</span>
                        <span id="pillar-hour" class="block text-amber-400 font-bold text-base mt-1">--</span>
                    </div>
                </div>
                
                <div id="lucky-hours-section" class="mt-6 pt-4 border-t border-slate-800">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-white text-sm uppercase tracking-wider flex items-center gap-2">
                            <i class="fas fa-hourglass-half text-amber-400"></i> Your Personal Lucky Hours
                        </h4>
                        <div class="flex items-center gap-2">
                            <span id="timezone-display" class="text-[9px] bg-amber-500/20 px-2 py-1 rounded-full text-amber-400">
                                <i class="fas fa-globe"></i> --
                            </span>
                        </div>
                    </div>
                    <div id="personal-lucky-hours" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="max-w-6xl mx-auto mt-16 text-center text-[10px] text-slate-700 uppercase tracking-widest">
        <span>Arcana Studio Labs ‚Ä¢ The Codex of the Witch ‚Ä¢ 2026 Cycle</span>
    </footer>

    <script>
        // ============================================
        // ARCANA STUDIO LABS - THE CODEX OF THE WITCH
        // LOVE TAB 100% FIXED - COMPLETE VERSION
        // ============================================
        
        // --- CONSTANTS & DATA LIBRARIES ---
        const ELEMENTS = [
            { name: 'Wood', color: '#10b981', desc: 'Growth & Vitality' },
            { name: 'Fire', color: '#ef4444', desc: 'Passion & Action' },
            { name: 'Earth', color: '#b45309', desc: 'Stability & Trust' },
            { name: 'Metal', color: '#e5e7eb', desc: 'Logic & Discipline' },
            { name: 'Water', color: '#3b82f6', desc: 'Wisdom & Flow' }
        ];

        const ZODIAC_EASTERN = ["Rat", "Ox", "Tiger", "Rabbit", "Dragon", "Snake", "Horse", "Goat", "Monkey", "Rooster", "Dog", "Pig"];
        const EASTERN_ELEMENTS = ["Wood", "Fire", "Earth", "Metal", "Water"];
        
        const GEMSTONES = {
            1: "Garnet", 2: "Amethyst", 3: "Aquamarine", 4: "Diamond", 
            5: "Emerald", 6: "Pearl", 7: "Ruby", 8: "Peridot", 9: "Sapphire"
        };
        
        const LUCKY_COLORS = {
            1: "Blue, Black", 2: "Yellow, Brown", 3: "Green", 4: "Green",
            5: "Yellow, Brown", 6: "White, Gold", 7: "White, Silver",
            8: "Yellow, Brown", 9: "Red, Pink"
        };
        
        const ANIMAL_CURES = {
            Rat: "üêÄ Gold Dragon", Ox: "üêÇ Jade Pi Yao", Tiger: "üêÖ Bronze Tiger", 
            Rabbit: "üêá Crystal Rabbit", Dragon: "üêâ Gold Dragon", Snake: "üêç Silver Snake",
            Horse: "üêé Bronze Horse", Goat: "üêê Jade Goat", Monkey: "üêí Crystal Monkey",
            Rooster: "üêì Gold Rooster", Dog: "üêï Bronze Dog", Pig: "üêñ Jade Pig"
        };

        const KUA_DIRECTIONS = {
            1: "North", 2: "Southwest", 3: "East", 4: "Southeast",
            5: "Center", 6: "Northwest", 7: "West", 8: "Northeast", 9: "South"
        };

        const COMFORT_QUOTES = [
            { min: 0, max: 2, quote: "Even the darkest night will end and the sun will rise. Your stars are realigning." },
            { min: 0, max: 2, quote: "This too shall pass. What is forged in fire becomes unbreakable." },
            { min: 0, max: 2, quote: "The universe hears your struggles. Patience, young soul." },
            { min: 2, max: 3, quote: "You are exactly where you need to be. Trust the journey." },
            { min: 2, max: 3, quote: "Small steps still move you forward. Celebrate your progress." },
            { min: 3, max: 4, quote: "The tide is turning in your favor. Prepare for blessings." },
            { min: 3, max: 4, quote: "Your light is growing brighter. Others are inspired by you." },
            { min: 4, max: 5, quote: "The stars dance in your honor today. Magnificent alignment." },
            { min: 4, max: 5, quote: "You are the architect of your destiny. Today proves your power." },
            { min: 5, max: 6, quote: "Exceptional fortune flows through you. Share your light generously." }
        ];

        // --- STATE MANAGEMENT ---
        let isLoading = false;
        let currentProphecyTab = 'wealth';
        let propheciesData = null;

        // --- GLOBAL TAB SWITCHING FUNCTION - CRITICAL FOR LOVE TAB ---
        // DEFINED ONCE AND MADE GLOBAL
        window.switchProphecyTab = function(tab) {
            console.log("Tab clicked:", tab);
            
            if (!propheciesData) {
                console.log("No prophecy data yet");
                return;
            }
            
            currentProphecyTab = tab;
            
            const tabs = ['wealth', 'career', 'health', 'love'];
            tabs.forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                if (el) {
                    if (t === tab) {
                        el.classList.add('active', 'text-amber-400', 'border-amber-500/30');
                        el.classList.remove('text-slate-400', 'border-transparent');
                    } else {
                        el.classList.remove('active', 'text-amber-400', 'border-amber-500/30');
                        el.classList.add('text-slate-400', 'border-transparent');
                    }
                }
            });
            
            updateProphecyDisplay();
        };

        // CREATE GLOBAL FUNCTION REFERENCE
        const switchProphecyTab = window.switchProphecyTab;

        // --- FORM VALIDATION ---
        function validateForm() {
            const name = document.getElementById('name').value.trim();
            const dob = document.getElementById('dob').value;
            const tob = document.getElementById('tob').value;
            const gender = document.getElementById('gender').value;
            const relationship = document.getElementById('relationship').value;
            const country = document.getElementById('country').value;
            const timezone = document.getElementById('timezone').value;
            const career = document.getElementById('career').value;
            
            const isComplete = name && dob && tob && gender && relationship && country && timezone && career;
            
            const invokeBtn = document.getElementById('invokeBtn');
            const formWarning = document.getElementById('form-warning');
            
            if (isComplete) {
                invokeBtn.disabled = false;
                invokeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                invokeBtn.innerHTML = '<i class="fas fa-crystal-ball"></i><span>FORGE YOUR DESTINY</span>';
                formWarning.innerHTML = '‚ú® Your cosmic identity is complete. Forge your reading.';
                formWarning.classList.remove('text-amber-400/70');
                formWarning.classList.add('text-emerald-400/70');
            } else {
                invokeBtn.disabled = true;
                invokeBtn.classList.add('opacity-50', 'cursor-not-allowed');
                invokeBtn.innerHTML = '<i class="fas fa-crystal-ball"></i><span>COMPLETE YOUR CELESTIAL IDENTITY</span>';
                formWarning.innerHTML = '‚ö†Ô∏è All fields required to forge your reading';
                formWarning.classList.remove('text-emerald-400/70');
                formWarning.classList.add('text-amber-400/70');
            }
            
            return isComplete;
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Arcana Studio Labs initialized - Love tab fix applied");
            
            const inputs = ['name', 'dob', 'tob', 'gender', 'relationship', 'country', 'timezone', 'career'];
            inputs.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('change', validateForm);
                    el.addEventListener('keyup', validateForm);
                }
            });
            
            getMoonPhase();
            setInterval(getMoonPhase, 60000);
            
            setTimeout(() => {
                loadFromStorage();
            }, 100);
        });

        // --- MAIN CALCULATION ENGINE ---
        window.calculateOracle = function() {
            if (!validateForm()) {
                alert("Please complete all fields to forge your cosmic identity.");
                return;
            }

            const invokeBtn = document.getElementById('invokeBtn');
            const nameInput = document.getElementById('name').value.trim();
            const dobInput = document.getElementById('dob').value;
            const tobInput = document.getElementById('tob').value;
            const gender = document.getElementById('gender').value;
            const relationship = document.getElementById('relationship').value;
            const timezone = parseFloat(document.getElementById('timezone').value) || 0;
            const career = document.getElementById('career').value;

            invokeBtn.disabled = true;
            invokeBtn.innerHTML = '<span class="spinner"></span> Forging your destiny...';

            try {
                const birthDate = new Date(dobInput);
                const birthYear = birthDate.getFullYear();
                const birthMonth = birthDate.getMonth() + 1;
                const birthDay = birthDate.getDate();
                const timeParts = tobInput.split(':');
                const birthHour = parseInt(timeParts[0]) || 12;
                const today = new Date();
                const currentHour = today.getHours();
                const seed = Math.abs((birthYear * birthMonth * birthDay + nameInput.length) % 97) || 1;

                // Personal Year
                const pyRaw = birthDay + birthMonth + 2026;
                const py = reduceToSingleDigit(pyRaw);
                setElementText('res-py', py);
                
                const startOfYear = new Date(today.getFullYear(), 0, 0);
                const diff = today - startOfYear;
                const oneDay = 1000 * 60 * 60 * 24;
                const dayOfYear = Math.floor(diff / oneDay);
                const yearProgress = (dayOfYear / 365) * 100;
                const pyProgress = document.getElementById('py-progress');
                if (pyProgress) pyProgress.style.width = `${Math.min(100, yearProgress)}%`;
                
                const pyElement = EASTERN_ELEMENTS[(py - 1) % 5];
                setElementText('res-py-element', `Element: <span class="text-amber-400">${pyElement}</span>`);

                // Kua Number
                const kua = calculateKua(birthYear, gender);
                const luckyDir = getKuaDirection(kua);
                setElementText('res-dir', luckyDir);

                // Wu Xing Elements
                const elementStrengths = calculateWuXing(birthYear, birthMonth, birthDay, birthHour, gender);
                renderElements(elementStrengths);
                const dominantIdx = elementStrengths.indexOf(Math.max(...elementStrengths));
                setElementText('dominant-element', `${ELEMENTS[dominantIdx].name} Dominant`);

                // Zodiac
                setElementText('res-western', getWesternZodiac(birthMonth, birthDay));
                const easternSign = getEasternZodiac(birthYear);
                setElementText('res-eastern', easternSign);

                // Lucky Number
                const luckyNumber = calculateLuckyNumber(py, birthDay, kua);
                setElementText('res-num', luckyNumber);

                // Personal Gem
                setElementText('res-gem', GEMSTONES[py] || "Jade");

                // Lucky Color
                let displayKua = kua;
                if (kua === 5) {
                    displayKua = gender === 'male' ? 2 : 8;
                }
                setElementText('res-color', LUCKY_COLORS[displayKua] || "Gold, Yellow");

                // Lucky Animal Ornament
                setElementText('res-animal', ANIMAL_CURES[easternSign] || "Jade Pi Yao");

                // Four Pillars
                const pillars = calculateFourPillars(birthYear, birthMonth, birthDay, birthHour);
                setElementText('pillar-year', pillars.year);
                setElementText('pillar-month', pillars.month);
                setElementText('pillar-day', pillars.day);
                setElementText('pillar-hour', pillars.hour);

                // Fortune Meter
                const fortuneScore = calculateFortuneScore(py, kua, birthDay, seed);
                renderStarRating(fortuneScore);
                renderComfortQuote(fortuneScore);

                // PROPHECIES - MUST BE SET BEFORE TAB SWITCHING
                propheciesData = generateAllProphecies(seed, py, easternSign, luckyDir, relationship, career, kua);
                
                // Set initial prophecy display
                currentProphecyTab = 'wealth';
                updateProphecyDisplay();
                
                // Reset tab styling to Wealth
                window.switchProphecyTab('wealth');

                // Shichen Advice
                setElementText('res-advice', getShichenAdvice(currentHour));

                // Lucky Hours
                const luckyHours = calculateLuckyHours(py, birthDay, kua, today, easternSign, timezone);
                renderLuckyHours(luckyHours, timezone);

                // Relationship Status
                setElementText('relationship-display', `üíñ Relationship: <span class="text-amber-400">${getRelationshipLabel(relationship)}</span>`);

                // Timezone Display
                const timezoneDisplay = document.getElementById('timezone-display');
                if (timezoneDisplay) {
                    const tzOption = document.querySelector(`#timezone option[value="${timezone}"]`);
                    const tzText = tzOption ? tzOption.textContent.split(')')[0] + ')' : `UTC${timezone >= 0 ? '+' : ''}${timezone}`;
                    timezoneDisplay.innerHTML = `<i class="fas fa-globe"></i> ${tzText}`;
                }

                document.getElementById('results').classList.remove('hidden');
                
                setTimeout(() => {
                    window.scrollTo({ 
                        top: document.getElementById('results').offsetTop - 20, 
                        behavior: 'smooth' 
                    });
                }, 100);
                
            } catch (error) {
                console.error("Calculation error:", error);
                alert("An error occurred during calculation. Please try again.");
            }

            invokeBtn.disabled = false;
            invokeBtn.innerHTML = '<i class="fas fa-crystal-ball"></i><span>FORGE YOUR DESTINY</span>';
        };

        // --- FORTUNE SCORE ---
        function calculateFortuneScore(py, kua, day, seed) {
            let score = 3;
            if (py === 1 || py === 3 || py === 5 || py === 7 || py === 9) score += 0.5;
            if (py === 2 || py === 4 || py === 6 || py === 8) score -= 0.2;
            if (kua === 1 || kua === 3 || kua === 4 || kua === 9) score += 0.3;
            if (kua === 2 || kua === 5 || kua === 8) score += 0.1;
            if (day % 7 === 0) score += 0.4;
            if (day % 5 === 0) score += 0.2;
            score += (seed % 10) / 20;
            score = Math.max(1, Math.min(5, score));
            return Math.round(score * 2) / 2;
        }

        // --- RENDER STAR RATING ---
        function renderStarRating(score) {
            const stars = [1, 2, 3, 4, 5];
            const fullStars = Math.floor(score);
            const hasHalfStar = score % 1 !== 0;
            
            stars.forEach(star => {
                const starEl = document.getElementById(`star-${star}`);
                if (starEl) {
                    if (star <= fullStars) {
                        starEl.innerHTML = '<i class="fas fa-star"></i>';
                        starEl.classList.add('filled');
                    } else if (star === fullStars + 1 && hasHalfStar) {
                        starEl.innerHTML = '<i class="fas fa-star-half-alt"></i>';
                        starEl.classList.add('filled');
                    } else {
                        starEl.innerHTML = '<i class="far fa-star"></i>';
                        starEl.classList.remove('filled');
                    }
                }
            });
            
            let label = '';
            if (score >= 4.5) label = 'Exceptional ‚ú®';
            else if (score >= 3.5) label = 'Fortunate üåü';
            else if (score >= 2.5) label = 'Balanced ‚öñÔ∏è';
            else if (score >= 1.5) label = 'Challenging üåßÔ∏è';
            else label = 'Difficult ‚ö°';
            
            setElementText('fortune-label', `${score.toFixed(1)} Stars - ${label}`);
        }

        // --- RENDER COMFORT QUOTE ---
        function renderComfortQuote(score) {
            const quoteEl = document.getElementById('comfort-quote');
            if (!quoteEl) return;
            
            const quoteData = COMFORT_QUOTES.find(q => score >= q.min && score <= q.max) || 
                            COMFORT_QUOTES[Math.floor(Math.random() * COMFORT_QUOTES.length)];
            
            const quoteDiv = quoteEl.querySelector('.comfort-quote-text');
            if (quoteDiv) {
                quoteDiv.innerHTML = `"${quoteData.quote}"`;
            }
        }

        // --- GENERATE PROPHECIES ---
        function generateAllProphecies(seed, py, animal, direction, relationship, career, kua) {
            const wealthProphecies = [
                `A financial opportunity from the ${direction} will manifest within 3 months.`,
                `Your wealth luck peaks during ${getLuckyMonth(py)}.`,
                `Unexpected inheritance or gift may arrive.`,
                `Business partnerships formed in ${direction} prove lucrative.`,
                `Your Personal Year ${py} indicates steady financial growth.`
            ];
            
            const careerProphecies = [
                `Career advancement comes through ${direction}-facing opportunities.`,
                `A mentor figure will guide your professional growth.`,
                `${py === 1 || py === 9 ? 'Major promotion' : 'Career expansion'} indicated.`,
                `Your skills in ${career} will be recognized.`,
                `Networking during ${getLuckyHour(animal)} hours brings valuable connections.`
            ];
            
            const healthProphecies = [
                `Focus on ${getHealthElement(kua)} health.`,
                `The ${getAnimalElement(animal)} element affects your ${getBodyPart(animal)}.`,
                `Personal Year ${py} suggests ${py < 5 ? 'building immunity' : 'stress management'}.`,
                `Your dominant ${ELEMENTS[seed % 5].name} element needs balance.`,
                `Mental health: The ${animal} year brings emotional sensitivity.`
            ];
            
            let loveProphecies;
            switch(relationship) {
                case 'single':
                    loveProphecies = [
                        `A ${direction}-directional romance appears in ${getLoveMonth(py)}.`,
                        `Your soulmate may be a ${getCompatibleAnimal(animal)} sign.`,
                        `The ${getCurrentMoonPhase()} moon activates your 5th house.`,
                        `Travel to the ${direction} increases chances of meeting someone special.`,
                        `Your ${getElementFromKua(kua)} energy attracts admirers.`
                    ];
                    break;
                case 'dating':
                    loveProphecies = [
                        `Your relationship deepens. Consider a ${direction}-facing location for your next date.`,
                        `Communication improves when wearing ${getLoveColor(kua)}.`,
                        `Commitment discussions favored during ${getLuckyMonth(py)}.`,
                        `${getCompatibleAnimal(animal)} energy strengthens your bond.`,
                        `Past relationship patterns heal. Your Personal Year ${py} brings emotional clarity.`
                    ];
                    break;
                case 'engaged':
                    loveProphecies = [
                        `Wedding planning favored. Choose ${getLoveColor(kua)}-toned elements.`,
                        `Your union is blessed by ${getElementFromKua(kua)} energy.`,
                        `Financial alignment strengthens before marriage.`,
                        `Family blessings flow from the ${getFamilyDirection(kua)} direction.`,
                        `Your ${animal} and partner's ${getPartnerAnimal(animal)} signs create powerful synergy.`
                    ];
                    break;
                case 'married':
                    loveProphecies = [
                        `Renew your vows or celebrate milestones.`,
                        `Shared goals in ${career} will strengthen your bond.`,
                        `Children or family expansion favored under ${getElementFromKua(kua)} element.`,
                        `Travel together to ${getRomanticDestination(animal)} rekindles passion.`,
                        `Financial security in marriage grows.`
                    ];
                    break;
                case 'divorced':
                    loveProphecies = [
                        `Healing and new beginnings. The ${direction} offers fresh romantic prospects.`,
                        `Self-love is your priority. ${getLoveColor(kua)} colors restore your heart chakra.`,
                        `Legal matters resolve favorably.`,
                        `A ${getCompatibleAnimal(animal)} friend may become something more.`,
                        `Your independence attracts quality partners.`
                    ];
                    break;
                case 'widowed':
                    loveProphecies = [
                        `Spiritual signs from beyond bring comfort.`,
                        `Honor your past while opening to new possibilities.`,
                        `Your loved one wants you to find happiness.`,
                        `Creative expression heals grief.`,
                        `A kindred spirit enters your life. Trust divine timing.`
                    ];
                    break;
                default:
                    loveProphecies = [
                        `Clarity comes from the ${direction}.`,
                        `Set boundaries. Your ${animal} energy needs protection.`,
                        `A decision by ${getLuckyMonth(py)} will bring resolution.`,
                        `Communication with ${getCompatibleAnimal(animal)} energy helps.`,
                        `Focus on self-worth. Your Personal Year ${py} builds inner strength.`
                    ];
            }

            return {
                wealth: wealthProphecies[seed % wealthProphecies.length],
                career: careerProphecies[seed % careerProphecies.length],
                health: healthProphecies[seed % healthProphecies.length],
                love: loveProphecies[seed % loveProphecies.length]
            };
        }

        function updateProphecyDisplay() {
            if (!propheciesData) return;
            
            const prophecy = propheciesData[currentProphecyTab];
            const titles = {
                wealth: { icon: 'fa-coins', title: 'Wealth Prophecy' },
                career: { icon: 'fa-briefcase', title: 'Career Prophecy' },
                health: { icon: 'fa-heartbeat', title: 'Health Prophecy' },
                love: { icon: 'fa-heart', title: 'Love Prophecy' }
            };
            
            const iconEl = document.getElementById('prophecy-icon');
            const titleEl = document.getElementById('prophecy-title');
            const prophecyEl = document.getElementById('main-prophecy');
            
            if (iconEl) iconEl.className = `fas ${titles[currentProphecyTab].icon}`;
            if (titleEl) titleEl.innerText = titles[currentProphecyTab].title;
            if (prophecyEl) prophecyEl.innerHTML = `<span class="text-amber-400 font-bold">"${prophecy}"</span>`;
        }

        // ========== UTILITY FUNCTIONS ==========
        function setElementText(id, text) {
            const el = document.getElementById(id);
            if (el) {
                if (typeof text === 'string' && text.includes('<')) {
                    el.innerHTML = text;
                } else {
                    el.innerText = text;
                }
            }
        }

        function reduceToSingleDigit(num) {
            if (isNaN(num)) return 1;
            let s = num.toString().split('').reduce((a, b) => parseInt(a || 0) + parseInt(b || 0), 0);
            while (s > 9) {
                s = s.toString().split('').reduce((a, b) => parseInt(a || 0) + parseInt(b || 0), 0);
            }
            return s || 1;
        }

        function calculateKua(year, gender) {
            if (year < 1900) year = 1900;
            if (year > 2099) year = 2099;
            
            let lastTwo = year % 100;
            let sum = lastTwo.toString().split('').reduce((a, b) => parseInt(a || 0) + parseInt(b || 0), 0);
            while (sum > 9) {
                sum = sum.toString().split('').reduce((a, b) => parseInt(a || 0) + parseInt(b || 0), 0);
            }
            
            let kua;
            if (gender === 'male') {
                kua = year >= 2000 ? 9 - sum : 10 - sum;
            } else {
                kua = year >= 2000 ? 6 + sum : 5 + sum;
            }
            
            if (kua > 9) {
                kua = kua.toString().split('').reduce((a, b) => parseInt(a || 0) + parseInt(b || 0), 0);
            }
            
            return kua;
        }

        function getKuaDirection(kua) {
            return KUA_DIRECTIONS[kua] || "North";
        }

        function getElementFromKua(kua) {
            const elements = ["Water", "Earth", "Wood", "Wood", "Earth", "Metal", "Metal", "Earth", "Fire"];
            return elements[kua - 1] || "Earth";
        }

        function calculateWuXing(year, month, day, hour, gender) {
            const yearStem = (year - 4) % 10;
            const monthStem = (yearStem * 2 + month) % 10;
            const dayStem = Math.abs(year + month + day) % 10;
            const hourStem = (dayStem * 2 + Math.floor(hour / 2)) % 10;
            
            const stemElements = [0, 0, 1, 1, 2, 2, 3, 3, 4, 4];
            const elementCounts = [1, 1, 1, 1, 1];
            
            if (yearStem >= 0) elementCounts[stemElements[yearStem]] += 2;
            if (monthStem >= 0) elementCounts[stemElements[monthStem]] += 3;
            if (dayStem >= 0) elementCounts[stemElements[dayStem]] += 4;
            if (hourStem >= 0) elementCounts[stemElements[hourStem]] += 1;
            
            if (gender === 'male') {
                elementCounts[1] += 1;
            } else {
                elementCounts[4] += 1;
            }
            
            const max = Math.max(...elementCounts);
            const min = Math.min(...elementCounts);
            const range = max - min || 1;
            
            return elementCounts.map(count => 30 + Math.floor((count - min) / range * 50));
        }

        function renderElements(strengths) {
            const container = document.getElementById('element-bars');
            if (!container) return;
            
            container.innerHTML = '';
            
            ELEMENTS.forEach((el, i) => {
                const strength = strengths[i] || 50;
                container.innerHTML += `
                    <div class="element-row group">
                        <div class="flex justify-between text-[11px] mb-1">
                            <span class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full" style="background: ${el.color}"></span>
                                <span class="text-white">${el.name}</span>
                                <span class="text-[9px] text-slate-500">${el.desc}</span>
                            </span>
                            <span class="text-amber-400 font-bold">${strength}%</span>
                        </div>
                        <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                            <div class="element-bar h-full rounded-full relative" 
                                 style="width: ${strength}%; background: ${el.color}; box-shadow: 0 0 10px ${el.color}40">
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function getWesternZodiac(month, day) {
            const dates = [
                { sign: "Capricorn", start: 1222, end: 119 },
                { sign: "Aquarius", start: 120, end: 218 },
                { sign: "Pisces", start: 219, end: 320 },
                { sign: "Aries", start: 321, end: 419 },
                { sign: "Taurus", start: 420, end: 520 },
                { sign: "Gemini", start: 521, end: 620 },
                { sign: "Cancer", start: 621, end: 722 },
                { sign: "Leo", start: 723, end: 822 },
                { sign: "Virgo", start: 823, end: 922 },
                { sign: "Libra", start: 923, end: 1022 },
                { sign: "Scorpio", start: 1023, end: 1121 },
                { sign: "Sagittarius", start: 1122, end: 1221 }
            ];
            
            const dateNum = month * 100 + day;
            
            for (let d of dates) {
                if (d.sign === "Capricorn") {
                    if (dateNum >= d.start || dateNum <= d.end) return d.sign;
                } else {
                    if (dateNum >= d.start && dateNum <= d.end) return d.sign;
                }
            }
            return "Capricorn";
        }

        function getEasternZodiac(year) {
            return ZODIAC_EASTERN[(year - 4) % 12];
        }

        function calculateLuckyNumber(py, day, kua) {
            return reduceToSingleDigit(py + day + kua);
        }

        function calculateFourPillars(year, month, day, hour) {
            const stems = ["Jia", "Yi", "Bing", "Ding", "Wu", "Ji", "Geng", "Xin", "Ren", "Gui"];
            const branches = ["Zi", "Chou", "Yin", "Mao", "Chen", "Si", "Wu", "Wei", "Shen", "You", "Xu", "Hai"];
            
            const yearStemIdx = (year - 4) % 10;
            const yearBranchIdx = (year - 4) % 12;
            const monthStemIdx = (yearStemIdx * 2 + month) % 10;
            const monthBranchIdx = (month + 1) % 12;
            const dayOffset = Math.abs(year + month + day) % 60;
            const dayStemIdx = dayOffset % 10;
            const dayBranchIdx = dayOffset % 12;
            const hourBranchIdx = Math.floor((hour + 1) / 2) % 12;
            const hourStemIdx = (dayStemIdx * 2 + hourBranchIdx) % 10;
            
            return {
                year: `${stems[yearStemIdx]} ${branches[yearBranchIdx]}`,
                month: `${stems[monthStemIdx]} ${branches[monthBranchIdx]}`,
                day: `${stems[dayStemIdx]} ${branches[dayBranchIdx]}`,
                hour: `${stems[hourStemIdx]} ${branches[hourBranchIdx]}`
            };
        }

        // ========== LUCKY HOURS ==========
        function calculateLuckyHours(py, day, kua, date, animalSign, timezone) {
            const kuaHourMap = {
                1: { start: 7, end: 9, quality: "Excellent" },
                2: { start: 9, end: 11, quality: "Good" },
                3: { start: 11, end: 13, quality: "Excellent" },
                4: { start: 13, end: 15, quality: "Good" },
                6: { start: 15, end: 17, quality: "Excellent" },
                7: { start: 17, end: 19, quality: "Good" },
                8: { start: 19, end: 21, quality: "Excellent" },
                9: { start: 21, end: 23, quality: "Good" }
            };
            
            const kuaHour = kuaHourMap[kua] || { start: 9, end: 11, quality: "Good" };
            
            const now = new Date();
            const localOffset = -now.getTimezoneOffset() / 60;
            const offsetDiff = timezone - localOffset;
            
            function toLocalTime(utcHour) {
                let localHour = utcHour + offsetDiff;
                while (localHour < 0) localHour += 24;
                while (localHour >= 24) localHour -= 24;
                return Math.floor(localHour * 10) / 10;
            }
            
            const pyHour = (py * 2) % 8 + 13;
            
            const animalHours = {
                Rat: [23, 1], Ox: [1, 3], Tiger: [3, 5], Rabbit: [5, 7],
                Dragon: [7, 9], Snake: [9, 11], Horse: [11, 13], Goat: [13, 15],
                Monkey: [15, 17], Rooster: [17, 19], Dog: [19, 21], Pig: [21, 23]
            };
            
            const animalHour = animalHours[animalSign] || [9, 11];
            
            function formatTime(hour, minute) {
                const h = Math.floor(hour);
                const m = Math.round((hour - h) * 60) + minute;
                const adjustedHour = h + Math.floor(m / 60);
                const adjustedMin = m % 60;
                return `${adjustedHour.toString().padStart(2, '0')}:${adjustedMin.toString().padStart(2, '0')}`;
            }
            
            return [
                {
                    period: "üåÖ Morning",
                    timeDisplay: `${formatTime(toLocalTime(kuaHour.start), 15)} - ${formatTime(toLocalTime(kuaHour.end), 45)}`,
                    quality: kuaHour.quality,
                    element: getElementFromKua(kua),
                    advice: "Best for important meetings and decisions"
                },
                {
                    period: "‚òÄÔ∏è Afternoon",
                    timeDisplay: `${formatTime(toLocalTime(pyHour), 30)} - ${formatTime(toLocalTime(pyHour + 2), 0)}`,
                    quality: py % 2 === 0 ? "Excellent" : "Good",
                    element: EASTERN_ELEMENTS[(py - 1) % 5],
                    advice: "Ideal for creative work and problem-solving"
                },
                {
                    period: "üåô Evening",
                    timeDisplay: `${formatTime(toLocalTime(animalHour[0]), 45)} - ${formatTime(toLocalTime(animalHour[0] + 2), 15)}`,
                    quality: "Excellent",
                    element: getAnimalElement(animalSign),
                    advice: "Perfect for networking, social connections, and romance"
                }
            ];
        }

        function renderLuckyHours(hours, timezone) {
            const display = document.getElementById('personal-lucky-hours');
            if (!display) return;
            
            display.innerHTML = '';
            
            hours.forEach((hour) => {
                const qualityClass = hour.quality === 'Excellent' ? 'text-emerald-400 border-emerald-500/30' : 'text-amber-400 border-amber-500/30';
                const bgClass = hour.quality === 'Excellent' ? 'bg-emerald-500/5' : 'bg-amber-500/5';
                
                let elementColor = 'blue';
                if (hour.element === 'Wood') elementColor = 'emerald';
                else if (hour.element === 'Fire') elementColor = 'red';
                else if (hour.element === 'Earth') elementColor = 'amber';
                else if (hour.element === 'Metal') elementColor = 'gray';
                else elementColor = 'blue';
                
                display.innerHTML += `
                    <div class="lucky-hour-badge ${bgClass} p-4 rounded-xl border ${qualityClass} hover:border-opacity-100 transition-all">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs text-slate-400 uppercase tracking-wider">${hour.period}</span>
                            <span class="text-[9px] px-2 py-0.5 rounded-full ${hour.quality === 'Excellent' ? 'bg-emerald-500/20 text-emerald-300' : 'bg-amber-500/20 text-amber-300'}">${hour.quality}</span>
                        </div>
                        <span class="block text-lg font-bold text-white mb-1">${hour.timeDisplay}</span>
                        <div class="flex flex-col gap-1">
                            <div class="flex justify-between items-center">
                                <span class="text-[10px] text-slate-500">Element: <span class="text-${elementColor}-400">${hour.element}</span></span>
                                <span class="text-[9px] text-slate-500">UTC${timezone >= 0 ? '+' : ''}${timezone}</span>
                            </div>
                            <span class="text-[9px] text-slate-400"><i class="fas fa-star text-amber-500/60"></i> ${hour.advice}</span>
                        </div>
                    </div>
                `;
            });
        }

        // ========== HELPER FUNCTIONS ==========
        function getRelationshipLabel(rel) {
            const labels = {
                single: "Single & Seeking",
                dating: "Dating / In Love",
                engaged: "Engaged",
                married: "Married",
                divorced: "Divorced",
                widowed: "Widowed",
                complicated: "It's Complicated"
            };
            return labels[rel] || rel;
        }

        function getLuckyMonth(py) {
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            return months[(py - 1) % 12];
        }

        function getLoveMonth(py) {
            const months = ["May", "June", "July", "August", "September", "October", "November", "December", "January", "February", "March", "April"];
            return months[(py - 1) % 12];
        }

        function getLoveColor(kua) {
            const colors = ["Blue", "Yellow", "Green", "Green", "Yellow", "White", "White", "Yellow", "Red"];
            return colors[kua - 1] || "Gold";
        }

        function getCompatibleAnimal(animal) {
            const compatibility = {
                Rat: "Ox, Dragon, Monkey", Ox: "Rat, Snake, Rooster",
                Tiger: "Horse, Dog", Rabbit: "Goat, Dog, Pig",
                Dragon: "Rat, Monkey, Rooster", Snake: "Ox, Rooster",
                Horse: "Tiger, Goat", Goat: "Rabbit, Horse, Pig",
                Monkey: "Rat, Dragon", Rooster: "Ox, Dragon, Snake",
                Dog: "Tiger, Rabbit", Pig: "Rabbit, Goat"
            };
            return compatibility[animal] || animal;
        }

        function getPartnerAnimal(animal) {
            const partners = {
                Rat: "Ox", Ox: "Rat", Tiger: "Horse", Rabbit: "Goat",
                Dragon: "Monkey", Snake: "Rooster", Horse: "Tiger",
                Goat: "Rabbit", Monkey: "Dragon", Rooster: "Snake",
                Dog: "Tiger", Pig: "Rabbit"
            };
            return partners[animal] || animal;
        }

        function getAnimalElement(animal) {
            const elements = {
                Rat: "Water", Ox: "Earth", Tiger: "Wood", Rabbit: "Wood",
                Dragon: "Earth", Snake: "Fire", Horse: "Fire", Goat: "Earth",
                Monkey: "Metal", Rooster: "Metal", Dog: "Earth", Pig: "Water"
            };
            return elements[animal] || "Earth";
        }

        function getBodyPart(animal) {
            const parts = {
                Rat: "kidneys and bladder", Ox: "spleen and stomach",
                Tiger: "liver and eyes", Rabbit: "liver and nerves",
                Dragon: "stomach and muscles", Snake: "heart and blood",
                Horse: "heart and spine", Goat: "spleen and digestion",
                Monkey: "lungs and large intestine", Rooster: "lungs and skin",
                Dog: "stomach and bones", Pig: "kidneys and reproductive system"
            };
            return parts[animal] || "immune system";
        }

        function getHealthElement(kua) {
            const elements = ["Water", "Earth", "Wood", "Wood", "Earth", "Metal", "Metal", "Earth", "Fire"];
            return elements[kua - 1] || "Earth";
        }

        function getFamilyDirection(kua) {
            const dirs = ["North", "Southwest", "East", "Southeast", "Center", "Northwest", "West", "Northeast", "South"];
            return dirs[kua - 1] || "Center";
        }

        function getRomanticDestination(animal) {
            const destinations = {
                Rat: "Venice", Ox: "Kyoto", Tiger: "Bali", Rabbit: "Paris",
                Dragon: "Santorini", Snake: "Marrakech", Horse: "Tuscany",
                Goat: "Swiss Alps", Monkey: "Hong Kong", Rooster: "Prague",
                Dog: "London", Pig: "Hawaii"
            };
            return destinations[animal] || "a tropical beach";
        }

        function getLuckyHour(animal) {
            const hours = {
                Rat: "23:00-01:00", Ox: "01:00-03:00", Tiger: "03:00-05:00",
                Rabbit: "05:00-07:00", Dragon: "07:00-09:00", Snake: "09:00-11:00",
                Horse: "11:00-13:00", Goat: "13:00-15:00", Monkey: "15:00-17:00",
                Rooster: "17:00-19:00", Dog: "19:00-21:00", Pig: "21:00-23:00"
            };
            return hours[animal] || "09:00-11:00";
        }

        function getCurrentMoonPhase() {
            const phases = ["New", "Waxing Crescent", "First Quarter", "Waxing Gibbous", "Full", "Waning Gibbous", "Last Quarter", "Waning Crescent"];
            const date = new Date();
            const phase = Math.floor((date.getDate() % 28) / 3.5) % 8;
            return phases[phase];
        }

        function getShichenAdvice(hour) {
            const periods = [
                { name: "Zi (Rat)", time: "23:00-01:00", advice: "Rest and recharge. Your subconscious is active." },
                { name: "Chou (Ox)", time: "01:00-03:00", advice: "Focus on stability. Good time for planning." },
                { name: "Yin (Tiger)", time: "03:00-05:00", advice: "Take action. Your energy is rising." },
                { name: "Mao (Rabbit)", time: "05:00-07:00", advice: "Be gentle with yourself and others." },
                { name: "Chen (Dragon)", time: "07:00-09:00", advice: "Power hour! Make important decisions." },
                { name: "Si (Snake)", time: "09:00-11:00", advice: "Strategic planning is favored." },
                { name: "Wu (Horse)", time: "11:00-13:00", advice: "High energy. Tackle challenging tasks." },
                { name: "Wei (Goat)", time: "13:00-15:00", advice: "Seek harmony in communications." },
                { name: "Shen (Monkey)", time: "15:00-17:00", advice: "Innovative ideas flow freely." },
                { name: "You (Rooster)", time: "17:00-19:00", advice: "Clarity and precision are heightened." },
                { name: "Xu (Dog)", time: "19:00-21:00", advice: "Protect your energy. Set boundaries." },
                { name: "Hai (Pig)", time: "21:00-23:00", advice: "Abundance mindset. Count blessings." }
            ];
            
            const idx = Math.floor(hour / 2) % 12;
            const period = periods[idx];
            
            return `<span class="text-amber-400 font-medium">${period.name} Hour (${period.time})</span><br><span class="text-sm text-slate-300">${period.advice}</span>`;
        }

        function getMoonPhase() {
            try {
                const date = new Date();
                const knownNewMoon = new Date(2000, 0, 6, 18, 14, 0);
                const lunarCycle = 29.530588853;
                
                const msSince = date - knownNewMoon;
                const daysSince = msSince / (1000 * 60 * 60 * 24);
                const phase = (daysSince % lunarCycle) / lunarCycle;
                
                let phaseName;
                if (phase < 0.03) phaseName = "New Moon";
                else if (phase < 0.24) phaseName = "Waxing Crescent";
                else if (phase < 0.26) phaseName = "First Quarter";
                else if (phase < 0.49) phaseName = "Waxing Gibbous";
                else if (phase < 0.53) phaseName = "Full Moon";
                else if (phase < 0.74) phaseName = "Waning Gibbous";
                else if (phase < 0.76) phaseName = "Last Quarter";
                else phaseName = "Waning Crescent";
                
                const illumination = phase < 0.5 ? phase * 200 : (1 - phase) * 200;
                
                setElementText('moon-display', phaseName);
                setElementText('moon-illumination', `üåó ${Math.round(illumination)}% Illuminated`);
                
                const daysToFull = phase < 0.5 ? (0.5 - phase) * lunarCycle : (1.5 - phase) * lunarCycle;
                const nextPhase = phase < 0.5 ? "Full Moon" : "New Moon";
                setElementText('moon-desc', `${nextPhase} in ${Math.round(daysToFull)} days`);
            } catch (e) {
                console.log("Moon phase calculation error:", e);
            }
        }

        function saveToLocalStorage(data) {
            try {
                localStorage.setItem('zenith_last_calculation', JSON.stringify(data));
            } catch (e) {
                console.log('Storage not available');
            }
        }

        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('zenith_last_calculation');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.name) document.getElementById('name').value = data.name;
                    if (data.dob) document.getElementById('dob').value = data.dob;
                    if (data.tob) document.getElementById('tob').value = data.tob;
                    if (data.gender) document.getElementById('gender').value = data.gender;
                    if (data.relationship) document.getElementById('relationship').value = data.relationship;
                    if (data.timezone) document.getElementById('timezone').value = data.timezone;
                    if (data.career) document.getElementById('career').value = data.career;
                }
                validateForm();
            } catch (e) {
                console.log('Error loading from storage');
            }
        }
    </script>
</body>
</html>